**内部类笔记**  

----------


**一、内部类的概念与分类**  
如果一个事物的内部包含另一个事物，那么这就是一个类内部包含另一个类  
例如：身体和心脏；汽车和发动机（心脏离开身体就无用了，发动机离开汽车也无用了）  

分类：  
1.成员内部类  
2.局部内部类（包含匿名内部类）  

**二、成员内部类的定义**  
1.格式：  

    修饰符 class 外部类名称 {
        修饰符 class 内部类名称 {
            //...
        }
        //...
    }

2.注意：内用外，随意访问；外用内，一定需要借助内部类对象  

**三、成员内部类的使用**  
1.间接方式：在外部类的方法中使用内部类，然后main只是调用外部类的方法  
2.直接方式：【外部类名称.内部类名称 对象名 = new 外部类名称().new 内部类名称();】  
Body.java  

```java
package day0802.innerClass.demo01;

public class Body {
    public class Heart {//成员内部类

        public void beat() {
            System.out.println("心脏砰砰跳");
        }
    }

    public void BodyMethod() {
        new Heart().beat();
    }
}
```

Demo01Test.java  

```java
package day0802.innerClass.demo01;

public static void main(String[] args) {
    //间接方式
    Body body = new Body();
    body.BodyMethod();
    System.out.println("==============");
    //直接方式
    Body.Heart heart = new Body().new Heart();
    heart.beat();
}
```

**四、内部类的同名变量访问**  
格式：外部类名称.this.外部类成员变量名  

```java
public class Body {
    int num = 10;//外部类成员变量
    public class Heart {
        int num = 20;//内部类成员变量
        public void method() {
            int num = 30;//内部类方法局部变量
            System.out.println(num);//访问内部类方法局部变量输出30
            System.out.println(this.num);//访问内部类成员变量输出20
            System.out.println(Body.this.num);//访问外部类成员变量输出10
        }
    }
}
```

**五、局部内部类定义**  
如果一个类是定义在一个方法内部的，那么这就是一个局部内部类【局部：只有当前所属的方法才能使用它】  
定义格式：  

    修饰符 class 外部类名称 {
        修饰符 返回值类型 外部类方法名称(参数列表) {
            class 局部内部类名称 {
                //...
            }
        }
    }

定义一个类的时候，权限修饰符规则：  
1.外部类：public / (default)  
2.成员内部类：public / protected / (default) / private  
3.局部内部类：什么都不能写  

```java
public class Outer {
    public void outerMethod() {
        class Inner {
            int num = 10;
            public void innerMethod() {
                System.out.println(num);
            }
        }
        Inner inner = new Inner();
        inner.innerMethod();
    }

    public static void main(String[] args) {
        new Outer().outerMethod();
    }
}
```

**六、局部内部类的final问题**  
局部内部类如果希望访问所在方法的局部变量，那么这个局部变量就必须是【有效final的】  
备注：从java 8+开始，只要局部变量事实不变，那么final关键字可以省略  
原因：  
1.new出来的对象在堆内存中  
2.局部变量是跟着方法走的，在栈内存中  
3.方法运行结束后，立刻出栈，局部变量就会立刻消失  
4.但是new出来的对象会在堆中持续存在，直到垃圾回收消失  

```java
public class Outer {
    public void outerMethod() {
        [final] int num = 10;
        class Inner {
            public void innerMethod() {
                System.out.println(num);
            }
        }
    }
}
```

**七、匿名内部类**  
如果接口的实现类或者是父类的子类只需要使用唯一的一次，那么这种情况下就可以省略该类的定义，而改为使用【匿名内部类】  
匿名内部类的定义格式：  

    接口名称 对象名 = new 接口名称() {
        //覆盖重写接口中所有的抽象方法
    };

**八、匿名内部类的注意事项**  
1.对"new 接口名称() {...}"进行解析  
a.new代表创建对象的动作  
b.接口名称就是匿名内部类需要实现哪个接口  
c.{...}这才是匿名内部类的内容  

2.注意  
a.匿名内部类在创建对象的时候只能使用唯一一次；如果希望多次创建对象，而且类的内容一样的话，那么就必须使用单独定义的实现类了  
b.匿名对象，在调用方法的时候，只能调用唯一一次；如果希望同一个对象调用多次方法，那么必须给对象起个名字  
c.匿名内部类是省略了实现类/子类名称，但是匿名对象是省略了对象名称   强调：匿名内部类和匿名对象不是一回事！  
    
**九、类作为成员变量类型**  

**十、接口作为成员变量类型**  

**十一、接口作为方法的参数和返回值**  

**十二、发红包案例_分析（相关代码见文件demo03）**  
发红包案例：红包发出去之后，所有的人都有红包，大家抢完了之后，最后一个红包给群主自己  
注意：程序中的钱不能使用小数，因为小数会发生精度损失，可以将1元看成100分来计算  
红包分发的策略：  
1.普通红包（平均）：totalMoney / totalCount，余数放在最后一个红包当中  
2.手气红包（随机）：最少1分钱，最多不超过剩下金额平均数的2倍，应该越发越少  

**十三、发红包案例_普通红包平均**  

**十四、发红包案例_手气红包随机**  