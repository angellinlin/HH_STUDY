### 3.5.4 IO字节流

#### 一、IO流概述和分类

I:input 

O:output 

流：数据（字符，字节）1字符=2个字节 一个字节=8个二进制位

输入：把硬盘中的数据，读取到内存中使用

输出：把内存中的数据，写入到硬盘中保存。

分类：字符流（字符输入流Reader，字符输出流Writer）

​     字节流（字节输入流InputStream,字节输出流OutputStream）

​                               

 

#### 二、一切皆为字节

计算机中一切文件数据在存储时，都是以二进制数字形式保存到的。

字节流可以传输任意文件数据。

 

#### 三、字节输出流OutputStream& FileOutputStream

**（一）OutputStream****字节输出流**

java.io.OutputStream字节输出流：此抽象类是表示输出字节流的所有类的超类.
 定义了一些子类共性的成员方法：
 void close() 关闭此输出流并释放与此流有关的所有系统资源。
 void flush() 刷新此输出流并强制写出所有缓冲的输出字节。
 void write(byte[] b) 将 b.length 个字节从指定的 byte 数组写入此输出流。
 void write(byte[] b, int off, int len) 将指定 byte 数组中从偏移量 off 开始的 len 个字节写入此输出流。
 abstract void write(int b) 将指定的字节写入此输出流。
 

**（二）FileOutputStream****文件字节输出流**
 java.io.FileOutputStream extends OutputStream文件字节输出流
 **1****、作用**：把内存中的数据写到硬盘的文件中

**2****、构造方法：**
 FileOutputStream(String name) 创建一个向具有指定名称的文件中写入数据的输出文件流。
 FileOutputStream(File file)创建一个向指定 File 对象表示的文件中写入数据的文件输出流。
   参数：写入数据的目的地
     String name：目的地是一个文件的路径
     File file：目的地是一个文件
   构造方法的作用：
     1、创建一个FileOutputStream对象；
     2、会根据构造方法中传递的文件/文件路径，创建一个空的文件；
     3、会把FileOutputStream对象指向创建好的文件。

 

**（三）写入数据的原理（内存-->****硬盘)
**   java程序-->JVM（java虚拟机）-->OS(操作系统)-->OS调用数据的方法-->把数据写入到文件中
 **（四）字节输出流的使用步骤【重点】：**
 1、创建一个FileOutputStream对象，构造方法中传递写入数据的目的地；
 2、调用FileOutputStream对象的write方法，把数据写入到文件中；
 3、释放资源（流使用会占用一定的内存，使用完毕要把内存清空，提高程序的效率）

```
//1、创建一个FileOutputStream对象。构造方法中传递写入数据的目的地；
FileOutputStream fos=new FileOutputStream("Stream0727\\a.txt");
//2、调用FileOutputStream对象的write方法，把数据写入到文件中；
fos.write(97);//(写数据时会把十进制整数97转为二进制整数97)  a
//3、释放资源
fos.close();
```

任意的文本编辑器（记事本、notepad++）在打开文件时，都会查询编码表，把字节转为字符表示。

0-127：查询ASCII表

其他值：查询系统默认码表（中文系统GBK）

 

**（五）一次写入多个字节的方法：**
 void write(byte[] b) 将 b.length 个字节从指定的 byte 数组写入此输出流。
  一次写入多个字节：
    如果第一个字节是整数（0-127），那么显示时会查询ASCII表。
    如果第一个字节是负数，那第一个字节会和第二个字节，两个字节组成一个中文显示，查询系统默认码表（GBK）
 void write(byte[] b, int off, int len) 把字节数组的一部分写入到文件中
   int off：数组的开始索引，int len写几个字节

写入字符的方法：可以使用String类的方法把字符串转换为字节数组。
 byte[] getBytes()把字符串转为字节数组

 

**（六）字节输出流的续写和换行**

追加写/续写：使用两个参数的构造方法
 FileOutputStream(File file, boolean append)创建一个向指定 File 对象表示的文件中写入数据的文件输出流。
 FileOutputStream(String name, boolean append) 创建一个向具有指定 name 的文件中写入数据的输出文件流。
 参数：File file、String name：写入数据的目的地
    boolean append：追加写开关
     true:创建对象不会覆盖原文件，继续在文件末尾追加写数据
     false：创建一个新文件,覆盖原文件


 写换行：写换行符号
 windows：\r\n
 linux：/n
 mac：/r

```
FileOutputStream fos=new FileOu4544545 tputStream("Stream0727\\c.txt",true);
for (int i = 0; i < 10; i++) {
    fos.write("你好\r\n".getBytes());
}
fos.close();
```

 

#### 四、字节输入流InputStream& FileInputStream

**（一）java.io.InputStream****：字节输入流**
 此抽象类是表示字节输入流的所有类的超类。
 
 int read() 从输入流中读取数据的下一个字节。
 int read(byte[] b) 从输入流中读取一定数量的字节，并将其存储在缓冲区数组 b 中。
 void close() 关闭此输入流并释放与该流关联的所有系统资源。
 
 **（二）InputStream****：文件字节输入流**

java.io.FileInputStream extends InputStream：文件字节输入流
 作用：把硬盘文件中的数据读取到内存中使用。
 构造方法：
 FileInputStream(String name)
 FileInputStream(File file)
 参数：读取文件的数据源
   String name：文件的路径，File file：文件
 构造方法的作用：
   1、创建一个FileInputStream对象；
   2、把FileInputStream对象指向构造方法中要读取的文件。

 

**（三）读取数据的原理（硬盘-->****内存）**
 java程序-->JVM-->OS-->OS读取数据的方法-->读取文件
 
 **（四）字节输入流的使用步骤【重点】**
 1、创建一个FileInputStream对象，构造方法中绑定要读取的数据源；
 2、使用FileInputStream对象中的方法read读取文件；
 3、释放资源

```
/*
我们发现以上读取文件是一个重复过程，所以可以使用循环优化
不知道文件中有多少个字节，使用while循环
while循环的结束条件:(len=fis.read() ) != -1
1、fis.read()：读取一个字节
2、len=fis.read()：把读取到的字节赋值给变量len
3、(len=fis.read() ) != -1判断变量len是否不等于-1
 */
int len = 0;//记录读取到的字节
while ((len = fis.read()) != -1) {
    System.out.println((char) len);
}
/*必须用一个变量来接收read方法，否则：
第一步fis.read()得到97！=-1，则进入循环体
fis.read()读取到98，输出98
再进行判断fis.read()得到99！-1
进入循环体，打印输出fis.read此时为-1
这样就只会输出98  -1两个值
while (( fis.read()) != -1) {
    System.out.println(fis.read());
}*/
```

 

**（五）读取字节的原理：**

**1****、一次读取一个字节：**

 

 

**2****、一次读取多个字节：**

字节输入流一次读取多个字节的方法
 int read(byte[] b) 从输入流中读取一定数量的字节，并将其存储在缓冲区数组 b 中。
 明确两件事情：
 1、参数byte[] b的作用？
   起到缓冲作用，存储每个读取到的多个字节。
   数组的长度一般为1024（1kb）或者是1024的整数倍
 2、方法的返回值int是什么？
   每次读取的有效字节个数。
 String类构造方法：
 String(byte[] bytes)把字节数组转换为字符串
 String(byte[] bytes, int offset, int length) 把字节数组的一部分转换为字符串，offset数组的开始索引，length转换的字节个数

```
/*
发现以上读取是一个重复过程，可以使用循环优化
不知道文件中有多少字节，所以使用whie循环
 */
int len = 0;
byte[] bytes = new byte[1024];
while ( (len = fis.read(bytes)) !=-1){
    System.out.println(len);
    System.out.println(new String(bytes,0,len)); //只转换有效字节数，
}
```

 

 

#### 五、练习：文件复制

文件复制练习：一读一写
 明确：
   数据源：f:\\1.png
   数据目的地：d:\\1.jpg
 文件复制的步骤：
   1、创建一个FileInputStream对象。构造方法中绑定要读取的数据源。
   2、创建一个FileOutputStream对象，构造方法中绑定要写入的目的地。
   3、使用字节输入流对象的方法read读取文件；
   4、使用字节输出流对象的方法write写入目的地文件中；
   5、释放资源。先关闭写的，再关闭读的。（如果写完了，肯定读完了）

```
long start=System.currentTimeMillis();
 //1、创建一个FileInputStream对象。构造方法中绑定要读取的数据源。
 FileInputStream fis=new FileInputStream("F:\\1.png");
 //2、创建一个FileOutputStream对象，构造方法中绑定要写入的目的地。
 FileOutputStream fos=new FileOutputStream("D:\\1.png");
 //3、使用字节输入流对象的方法read读取文件；

 //一次读取一个字节的方式（速度慢）2526
 /*int len=0;
 while ((len=fis.read())!=-1){
     //4、使用字节输出流对象的方法write写入目的地文件中；
     fos.write(len);
 }*/

 //一次读取多个字节
int len=0;
 byte[] bytes=new byte[1024];
 while ((len=fis.read(bytes))!=-1){
     fos.write(bytes,0,len);  //写有效个数,速度快 7
 }
 //释放，
 fos.close();
 fis.close();
 long end=System.currentTimeMillis();
 System.out.println("复制文件耗时："+(end-start));
```

 

#### 六、使用字节流读取中文的问题

使用字节流读取中文文件
 1个中文：
   GBK：占用两个字节
   UTF-8：占用3个字节

```
FileInputStream fis=new FileInputStream("Stream0727\\c.txt");  //存储：你好
int len=0;
while ((len=fis.read())!=-1){
    System.out.println((char)len); //乱码
}
fis.close();
```

 