### 3.5.8 转换流

字符编码和字符集

GBK：一个中文使用两个字节

UTF-8：一个中文使用三个字节

FileReader可以读取IDE默认编码格式（UTF-8）的文件，读取系统默认编码（中文GBK）会产生乱码。因此需要“转换流”。

#### 一、转换流的原理

可以选择编码格式

​                               

 

#### 二、OutputStreamWriter写转换流

java.io.OutputStreamWriter extends Writer
 OutputStreamWriter：是字符通向字节的桥梁；可食用指定的charset将要写入流中的字符编码成字节。（编码：把能看懂的变成看不懂的）
 
 （一）继承自父类的共性成员方法：
  abstract void close() 关闭此流，但要先刷新它。
   void flush() 刷新该流的缓冲。
   void write(char[] cbuf) 写入字符数组。
   void write(char[] cbuf, int off, int len) 写入字符数组的某一部分。
   void write(int c) 写入单个字符。
   void write(String str) 写入字符串。
   void write(String str, int off, int len) 写入字符串的某一部分。
 
 （二）构造方法
 OutputStreamWriter(OutputStream out) 创建使用默认字符编码的 OutputStreamWriter
 OutputStreamWriter(OutputStream out, String charsetName)创建使用指定字符集的 OutputStreamWriter。
 参数：OutputStream out字节输出流，可以用来写转换之后的字节到文件中。
 String charsetName指定的编码表名称，不区分大小写，可以是UTF-8/utf-8，gbk/GBK.....不指定默认使用UTF-8
 
 (三)使用步骤
 1、创建OutputStreamWriter对象，构造方法中传递字节输出流和指定的编码表名称；
 2、使用OutputStreamWriter对象的方法write把字符转换为字节，存储到缓冲区中；
 3、使用OutputStreamWriter对象的方法flush把内存缓冲区中的字节刷新到文件中（使用字节流写字节的过程）
 4、释放资源

```
private static void write_gbk() throws IOException {
    OutputStreamWriter osw=new OutputStreamWriter(new FileOutputStream("IO0728\\gbk.txt"),"GBK");
    osw.write("你好"); //4字节
    osw.flush();
    osw.close();
}
private static void write_utf_8() throws IOException {
    //OutputStreamWriter osw=new OutputStreamWriter(new FileOutputStream("IO0728\\utf-8.txt"),"utf-8");
    //不指定默认为utf-8
    OutputStreamWriter osw=new OutputStreamWriter(new FileOutputStream("IO0728\\utf-8.txt"));
    osw.write("你好"); //6字节
    osw.flush();
    osw.close();
}
```

 

#### 三、InputStreamReader读转换流

```
InputStreamReader 是字节流通向字符流的桥梁：它使用指定的 charset 读取字节并将其解码为字符。
解码：把看不懂的变为看懂的。

（一）继承自父类的方法
 int read() 读取单个字符并返回。
 int read(char[] cbuf) 一次读取多个字符，存入数组
 void close()  释放资源

（二）构造方法
InputStreamReader(InputStream in) 创建一个使用默认字符集的 InputStreamReader。
InputStreamReader(InputStream in, String charsetName) 创建一个使用指定字符集的 InputStreamReader。
参数：InputStream in字节输入流，用来读取文件中保存的字节。
     String charsetName指定的编码表名称，不区分大小写，可以是UTF-8/utf-8，gbk/GBK.....不指定默认使用UTF-8

（三）使用步骤
 1、 创建InputStreamReader 对象，构造方法中传递字节输入流和指定的编码表名称；
 2、使用InputStreamReader对象的方法read读取文件；
 3、释放资源。

 （四）注意事项
 构造方法中指定的编码表名称要和文件的编码相同，否则会发生乱码。
private static void read_gbk() throws IOException {
    //InputStreamReader isr = new InputStreamReader(new FileInputStream("IO0728\\gbk.txt"), "utf-8");编码表名称要和文件编码一致
   InputStreamReader isr = new InputStreamReader(new FileInputStream("IO0728\\gbk.txt"), "GBK");
    int len = 0;
    char[] chars = new char[1024];
    while ((len=isr.read(chars))!=-1){
        System.out.println(new String(chars,0,len));
    }
    isr.close();
}
private static void read_utf_8() throws IOException {
    //InputStreamReader isr = new InputStreamReader(new FileInputStream("IO0728\\utf-8.txt"), "utf-8");
    InputStreamReader isr = new InputStreamReader(new FileInputStream("IO0728\\utf-8.txt"));
    int len = 0;
    char[] chars = new char[1024];
    while ((len=isr.read(chars))!=-1){
        System.out.println(new String(chars,0,len));
    }
    isr.close();
```

 

#### 四、练习：转换文件编码。

要求:将gbk编码的文件，转换为utf-8的文本文件。

分析：
 1、创建一个读的转换流，InputStreamReader，读取GBK格式的文件；
 2、创建一个写的转换流，OutputStreamWriter，将读取到的文本以UTF-8格式写入到文件中。

```
InputStreamReader isr = new InputStreamReader(new FileInputStream("IO0728\\我是GBK格式的文本.txt"), "GBK");
OutputStreamWriter osw = new OutputStreamWriter(new FileOutputStream("IO0728\\我是UTF-8格式的文本.txt"), "UTF-8");
int len = 0;
char[] chars = new char[1024];
while ((len = isr.read(chars)) != -1) {
    String str = new String(chars, 0, len);
    System.out.println(str);
    osw.write(str);
}
osw.flush();
osw.close();
isr.close();
```

 